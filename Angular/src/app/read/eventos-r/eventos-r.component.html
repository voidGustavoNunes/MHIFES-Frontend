<div class="caixa">
    <h1>Eventos</h1>

    <div class="opcao">
        <a (click)="showDialog()" class="p-button botaoC">Cadastrar +</a>
        
        <div class="pesq">
            <p-inputGroup>
                <button type="button" pButton icon="pi pi-filter-slash" (click)="limparFilter()"></button>
                <input #searchInput type="text" pInputText placeholder="Pesquisar evento por ano" (keydown)="onKeyDown($event, searchInput.value)" />
                <button type="button" pButton icon="pi pi-search" (click)="filterField(searchInput.value)"></button>
            </p-inputGroup>
        </div>
    </div>

    <div class="eqTable">
        <p-table
            #dt1
            [value]="eventosData"
            styleClass="p-datatable-striped"
            [tableStyle]="{'min-width': '50rem'}"
            [paginator]="true"
            [rows]="10"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Mostrando do {first} ao {last} de {totalRecords} registros"
            [rowsPerPageOptions]="[10, 20, 40]"
        >
            <ng-template pTemplate="header">
                <tr class="tbHeader">
                    <th>Intervalo de Datas</th>
                    <th>Descrição</th>
                    <th>Local</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-evento>
                <tr class="tbBody">
                    <td>{{ formatarDatas(evento?.intervaloData) }}</td>
                    <td>{{evento?.descricao}}</td>
                    <td>{{evento?.local}}</td>
                    <td>
                        <button type="button" class="botaoEdit" (click)="showEditDialog(evento)" pButton>Editar</button>
                        <p-toast></p-toast>
                        <p-confirmPopup></p-confirmPopup>
                        <button type="button" class="botaoDele" (click)="confirm2($event, evento?.id)" severity="danger" pButton>Deletar</button>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="3">Não há eventos cadastrados.</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    
    <p-scrollTop></p-scrollTop>
</div>


<div class="card flex justify-content-center">
    <p-dialog class="pHeader" [header]=ehTitulo [(visible)]="visible" [modal]="true" [breakpoints]="{ '960px': '75vw' }" [style]="{ width: '50vw' }" [draggable]="false" [resizable]="false">
        <form id="meuFormulario" [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class="divInput">
                <span class="p-float-label">
                    <p-calendar dateFormat="dd/mm/yy" selectionMode="multiple" id="itvData" class="form-control" formControlName="intervaloData" ></p-calendar>
                    <label for="itvData">Intervalo de Datas</label>
                </span>
            </div>
            <div class="divInput">
                <span class="p-float-label">
                    <textarea pInputTextarea rows="5" cols="30" id="descEvent" class="form-control" formControlName="descricao" ></textarea>
                    <label for="descEvent">Descrição</label>
                </span>
            </div>
            <div class="divInput">
                <span class="p-float-label">
                    <p-dropdown #dropdown [options]="locaisArray" optionLabel="name" [filter]="true" filterBy="nome" [showClear]="true" placeholder="Selecione um local" inputId="localEvent" class="form-control" formControlName="local">
                        <ng-template pTemplate="selectedItem" let-selectedOption>
                            <div class="flex align-items-center gap-2">
                                <div>{{ selectedOption?.nome }}</div>
                            </div>
                        </ng-template>
                        <ng-template let-localData pTemplate="item">
                            <div class="flex align-items-center gap-2">
                                <div>{{ localData.nome }}</div>
                            </div>
                        </ng-template>
                    </p-dropdown>
                    <label for="localEvent">Local</label>
                </span>
            </div>
            <div class="divBotao">
                <button type="submit" class="botaoSalva" *ngIf="cadastrar" pButton>Salvar</button>
                <button type="submit" class="botaoEdit" *ngIf="editar" pButton>Atualizar</button>
                <button type="button" class="botaoCancela" (click)="hideDialog()" pButton>Cancelar</button>
            </div>
        </form>
    </p-dialog>
</div>